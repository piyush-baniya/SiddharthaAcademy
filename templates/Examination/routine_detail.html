{% extends "management/base.html" %}
{% load dict_extras %}
{% load static %}
{% block title %}Routine — {{ routine.examination_name }}{% endblock %}










{% block content %}
  <!-- Message Box -->
  <div class="fixed top-5 right-5 z-50 max-w-xs space-y-3">
    {% for message in messages %}
      <div 
        x-data="{ show: true }" 
        x-show="show" 
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 transform translate-x-10"
        x-transition:enter-end="opacity-100 transform translate-x-0"
        x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="opacity-100 transform translate-x-0"
        x-transition:leave-end="opacity-0 transform translate-x-10"
        x-init="setTimeout(() => show = false, 4000)"
        class="p-4 rounded-lg shadow-lg flex items-center space-x-3
          {% if 'error' in message.tags %}
            bg-red-50 border border-red-400 text-red-800
          {% else %}
            bg-green-50 border border-green-400 text-green-800
          {% endif %}
        "
      >
        <svg class="w-6 h-6 flex-shrink-0
          {% if 'error' in message.tags %}text-red-600{% else %}text-green-600{% endif %}"
          fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 13l4 4L19 7"></path>
        </svg>
        <div class="flex-1 font-semibold text-sm">
          {{ message }}
        </div>
        <button @click="show = false" class="focus:outline-none
          {% if 'error' in message.tags %}text-red-600 hover:text-red-900{% else %}text-green-600 hover:text-green-900{% endif %}"
          aria-label="Close notification">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    {% endfor %}
  </div>


<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<div class="max-w-6xl mx-4 my-4 p-8 bg-white rounded-3xl shadow-lg">
  <div class="flex flex-col md:flex-row items-start justify-between gap-6">
    <div>
      <h1 class="text-3xl font-extrabold text-red-700">{{ routine.examination_name }}</h1>
      {% if routine.note_above %}
        <p class="mt-3 text-gray-600 text-base max-w-lg leading-relaxed">{{ routine.note_above }}</p>
      {% endif %}
    </div>
    <div class="text-right space-y-3">
      {% if routine.exam_time %}
        <div class="text-sm font-semibold text-gray-700">⏰ Time: <span class="text-red-600">{{ routine.exam_time }}</span></div>
      {% endif %}
      <div class="flex gap-3 justify-end">
        <a href="{% url 'exam:edit_routine' pk=routine.pk %}" 
           class="px-5 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition duration-200 font-semibold">
          Edit Routine
        </a>
        <a href="{% url 'exam:routine_preview' routine.pk %}" 
           class="px-5 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition duration-200 font-semibold">
          Preview
        </a>
      </div>
    </div>
  </div>

  <div class="overflow-x-auto mt-8 rounded-lg border border-gray-300 shadow-sm">
    <table class="min-w-full table-auto border-collapse">
      <thead class="bg-red-600 text-white sticky top-0">
        <tr>
          <th class="border-b border-gray-200 p-3 text-left font-semibold sticky left-0 bg-red-600 z-10">Date</th>
          {% for cls in class_names %}
            <th class="border-b border-gray-200 p-3 text-center font-semibold">{{ cls }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for d in dates %}
          <tr class="hover:bg-red-50 transition duration-150">
            <td class="border-b border-gray-200 p-3 font-mono sticky left-0 bg-white z-5">{{ d|date:"Y-m-d" }}</td>
            {% for cls in class_names %}
              <td class="border-b border-gray-200 p-3 text-center text-gray-800 font-medium">
                {{ grid|get_item:d|get_item:cls|default:"-" }}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if routine.note_below %}
    <div class="mt-6 text-gray-700 text-sm max-w-4xl leading-relaxed">
      {{ routine.note_below }}
    </div>
  {% endif %}
</div>
{% endblock %}

{% extends "management/base.html" %}
{% load static %}
{% block title %}Edit Teacher â€” Siddhartha Academy{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto p-8 bg-white rounded-xl shadow-md mt-10">
  <h1 class="text-3xl font-extrabold mb-8 text-gray-800 border-b pb-4">Edit Teacher</h1>

  <!-- Choices.js CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

  <form method="POST" enctype="multipart/form-data" class="space-y-8">
    {% csrf_token %}

    <!-- Basic Info -->
    <div class="space-y-6">
      <div>
        <label for="full_name" class="block text-sm font-semibold text-gray-700 mb-1">Full Name <span class="text-red-500">*</span></label>
        <input
          type="text"
          id="full_name"
          name="full_name"
          value="{{ teacher.full_name }}"
          required
          class="w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-300"
          placeholder="Enter full name"
        />
      </div>

      <div>
        <label for="email" class="block text-sm font-semibold text-gray-700 mb-1">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          value="{{ teacher.email }}"
          class="w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-300"
          placeholder="Enter email address"
        />
      </div>

      <div>
        <label for="phone" class="block text-sm font-semibold text-gray-700 mb-1">Phone</label>
        <input
          type="text"
          id="phone"
          name="phone"
          value="{{ teacher.phone }}"
          class="w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-300"
          placeholder="Enter contact number"
        />
      </div>

      <div>
        <label for="address" class="block text-sm font-semibold text-gray-700 mb-1">Address</label>
        <textarea
          id="address"
          name="address"
          rows="3"
          class="w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm placeholder-gray-400 resize-none focus:border-red-500 focus:ring-1 focus:ring-red-300"
          placeholder="Enter address"
        >{{ teacher.address }}</textarea>
      </div>

      <div>
        <label for="linkedin_profile" class="block text-sm font-semibold text-gray-700 mb-1">LinkedIn Profile URL</label>
        <input
          type="url"
          id="linkedin_profile"
          name="linkedin_profile"
          value="{{ teacher.linkedin_profile }}"
          class="w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-300"
          placeholder="https://linkedin.com/in/username"
        />
      </div>
    </div>

    <!-- Dates -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <label for="date_joined" class="block text-sm font-semibold text-gray-700 mb-1">Date Joined</label>
        <input
          type="date"
          id="date_joined"
          name="date_joined"
          value="{{ teacher.date_joined|date:'Y-m-d' }}"
          class="w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm focus:border-red-500 focus:ring-1 focus:ring-red-300"
        />
      </div>

      <div>
        <label for="date_left" class="block text-sm font-semibold text-gray-700 mb-1">Date Left</label>
        <input
          type="date"
          id="date_left"
          name="date_left"
          value="{{ teacher.date_left|date:'Y-m-d' }}"
          class="w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm focus:border-red-500 focus:ring-1 focus:ring-red-300"
        />
      </div>
    </div>

    <hr class="border-gray-200">

    <!-- Multi-select for ClassSubjects -->
    <div>
      <label for="class_subjects" class="block mb-2 font-semibold text-gray-700">Subjects and Classes to Teach</label>
      <select id="class_subjects" name="class_subjects" multiple
        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-red-500 transition">
        {% for cs in class_subjects %}
          <option value="{{ cs.id }}" {% if cs.id in assigned_cs_ids %}selected{% endif %}>{{ cs.subject.name }} - {{ cs.classroom }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- File Uploads -->
    <div class="space-y-6">

      <div>
        <label for="photo" class="block text-sm font-semibold text-gray-700 mb-1">Photo <span class="text-gray-500 text-xs">(Leave blank to keep current)</span></label>
        <input
          type="file"
          id="photo"
          name="photo"
          accept="image/*"
          class="w-full text-gray-700"
        />
        {% if teacher.photo %}
        <img src="{{ teacher.photo.url }}" alt="Current Photo" class="mt-3 h-24 w-24 object-cover rounded-full border-2 border-red-500 shadow-sm">
        {% endif %}
      </div>

      <div>
        <label for="related_document" class="block text-sm font-semibold text-gray-700 mb-1">Related Document</label>
        <input
          type="file"
          id="related_document"
          name="related_document"
          class="w-full text-gray-700"
        />
        {% if teacher.related_document %}
        <p class="mt-1 text-sm text-blue-600 hover:underline"><a href="{{ teacher.related_document.url }}" target="_blank">View Current Document</a></p>
        {% endif %}
      </div>

      <div>
        <label for="cv" class="block text-sm font-semibold text-gray-700 mb-1">CV</label>
        <input
          type="file"
          id="cv"
          name="cv"
          class="w-full text-gray-700"
        />
        {% if teacher.cv %}
        <p class="mt-1 text-sm text-blue-600 hover:underline"><a href="{{ teacher.cv.url }}" target="_blank">View Current CV</a></p>
        {% endif %}
      </div>

      <div>
        <label for="pan_card" class="block text-sm font-semibold text-gray-700 mb-1">PAN Card</label>
        <input
          type="file"
          id="pan_card"
          name="pan_card"
          class="w-full text-gray-700"
        />
        {% if teacher.pan_card %}
        <p class="mt-1 text-sm text-blue-600 hover:underline"><a href="{{ teacher.pan_card.url }}" target="_blank">View Current PAN Card</a></p>
        {% endif %}
      </div>

      <div>
        <label for="citizenship_front" class="block text-sm font-semibold text-gray-700 mb-1">Citizenship Front</label>
        <input
          type="file"
          id="citizenship_front"
          name="citizenship_front"
          class="w-full text-gray-700"
        />
        {% if teacher.citizenship_front %}
        <p class="mt-1 text-sm text-blue-600 hover:underline"><a href="{{ teacher.citizenship_front.url }}" target="_blank">View Current Citizenship Front</a></p>
        {% endif %}
      </div>

      <div>
        <label for="citizenship_back" class="block text-sm font-semibold text-gray-700 mb-1">Citizenship Back</label>
        <input
          type="file"
          id="citizenship_back"
          name="citizenship_back"
          class="w-full text-gray-700"
        />
        {% if teacher.citizenship_back %}
        <p class="mt-1 text-sm text-blue-600 hover:underline"><a href="{{ teacher.citizenship_back.url }}" target="_blank">View Current Citizenship Back</a></p>
        {% endif %}
      </div>
    </div>

    <!-- Actions -->
    <div class="pt-6 flex justify-end gap-4">
      <a href="{% url 'teachers_list' %}" class="px-6 py-3 rounded-lg border border-gray-300 hover:bg-gray-100 text-gray-700 font-semibold transition">Cancel</a>
      <button type="submit" class="px-6 py-3 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold transition">Save Changes</button>
    </div>
  </form>
</div>

<!-- Choices.js for searchable multi-select -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const element = document.getElementById('class_subjects');
    new Choices(element, {
      removeItemButton: true,
      searchEnabled: true,
      placeholderValue: 'Select subjects and classes',
      searchPlaceholderValue: 'Search...',
      shouldSort: false,
    });
  });
</script>

{% endblock %}
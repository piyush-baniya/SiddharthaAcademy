{% extends "management/base.html" %}
{% block title %}Class List — Siddhartha Academy{% endblock %}
{% block content %}
<h1 class="text-4xl font-extrabold mb-8 text-center mt-6 text-red-700">Class List</h1>

<div class="flex justify-end mb-6 max-w-6xl mx-auto px-4">
    <a href="{% url 'class_add' %}" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold shadow-md transition">+ Add Class</a>
</div>

<div
  x-data="{
    isDeleteOpen: false,
    deleteData: { id: null, name: '' },
    openDeleteModal(id, name) {
      this.deleteData.id = id;
      this.deleteData.name = name;
      this.isDeleteOpen = true;
    },
    closeDeleteModal() {
      this.isDeleteOpen = false;
      this.deleteData = { id: null, name: '' };
    }
  }"
  class="overflow-x-auto bg-white shadow-lg rounded-3xl max-w-6xl mx-4"
>
    <table class="w-full text-left border-collapse">
        <thead>
            <tr class="bg-red-600 text-white">
                <th class="py-3 px-4">Class Name</th>
                <th class="py-3 px-4">Class Teacher</th>
                <th class="py-3 px-4">Subjects</th>
                <th class="py-3 px-4 text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for class in classes %}
            <tr class="border-b hover:bg-gray-50 transition">
                <td class="py-3 px-4 font-medium">{{ class.name }}</td>
                <td class="py-3 px-4"> 
                {{ class.class_teacher.full_name|default:"—" }}
                </td>
              <td class="py-3 px-4">
                {% if class.subjects.all %}
                  <div class="flex flex-wrap gap-2">
                    {% for subject in class.subjects.all %}
                      <span
                        class="inline-block bg-red-100 text-red-800 text-xs font-semibold px-3 py-1 rounded-full shadow-sm select-none whitespace-nowrap"
                      >
                        {{ subject.name }}
                      </span>
                    {% endfor %}
                  </div>
                {% else %}
                  &mdash;
                {% endif %}
              </td>

                
                <td class="py-3 px-4 text-center space-x-2">
                    <a href="{% url 'class_edit' class.id %}" class="text-blue-600 hover:underline font-semibold">Edit</a>
                    <button
                      @click.prevent="openDeleteModal({{ class.id }}, '{{ class.name|escapejs }}')"
                      class="text-red-600 hover:underline font-semibold bg-transparent border-none cursor-pointer"
                      type="button"
                    >
                      Delete
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="py-6 text-center text-gray-500">No classes found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Delete Confirmation Modal -->
    <div
      x-show="isDeleteOpen"
      x-transition.opacity
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 sm:p-6"
      style="display: none;"
      @keydown.window.escape="closeDeleteModal()"
      @click="if ($event.target === $el) closeDeleteModal()"
      tabindex="0"
    >
      <div
        x-show="isDeleteOpen"
        x-transition.scale.origin.center
        class="bg-white rounded-3xl max-w-md w-full p-6 sm:p-8 shadow-2xl relative"
        role="dialog" aria-modal="true"
      >
        <button
          @click.prevent="closeDeleteModal()"
          class="absolute top-4 right-4 text-gray-500 hover:text-red-600 text-3xl font-bold focus:outline-none"
          aria-label="Close modal"
        >&times;</button>

        <h2 class="text-xl font-extrabold text-red-700 mb-6">Delete Confirmation</h2>

        <p class="mb-6 text-gray-700">
          Are you sure you want to delete
          <span class="font-semibold" x-text="deleteData.name"></span>?
        </p>

        <form method="POST" :action="`/manage/classes/delete/${deleteData.id}/`" class="flex justify-end gap-3">
          {% csrf_token %}
          <button type="button" @click="closeDeleteModal()" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 transition">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition">Delete</button>
        </form>
      </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
{% endblock %}
